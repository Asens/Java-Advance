---
description: MySQL中的基础知识，存储引擎，锁等
---

# MySQL基础

## 数据库的三大范式

范式是关系型数据库的设计标准，符合某一种级别的关系模式的集合，表示一个关系内部各属性之间的联系的合理化程度。可以理解为一张数据表的表结构所符合的某种设计标准的级别。

### 第一范式

1NF是所有关系型数据库的最基本要求，符合1NF的关系中的每个属性都不可再分

也就是列不可分，字段不可分

### 第二范式

2NF在1NF的基础之上，消除了非主属性对于码的部分函数依赖。

要有主键，其他列都依赖主键

### 第三范式

不可存在传递依赖

消除冗余，各种信息只在一个地方存储，不出现在多张表中。

比如商品表里面关联商品类别表，那么只需要一个关联字段product_type_id即可，其他字段信息可以通过表关联查询即可得到

### 反范式设计

- 提高查询效率

当订单表保存商品id时，有时同时保存商品名称，方便查询，提升效率

- 保存历史快照信息

记录历史信息

## 存储引擎

MySQL中提供了多种引擎，默认的存储引擎InnoDB

### InnoDB

默认的隔离级别的可重复读（Repeatable Read），并且通过间隙锁防止幻读的发生

InnoDB表基于聚簇索引，主键查询性能高，二级索引必须包含主键

支持完整事务和回滚

支持行级锁

### MyISAM

MySQL 5.1之前版本的默认引擎，不支持事务，支付全文索引，压缩

对整张表加锁，但是不支持行级锁

可延迟更新索引，极大提升写入性能

### 其它

- **Archive**：只支持insert和select操作，插入很快，插入时会进行压缩，支持行级锁，不支持事务
- **CSV**：把普通的CSV文件当作表处理，不支持NULL，方便Excel
- **Memory**：所有数据放在内存，很快，重启丢失，支持Hash索引，

### MyISAM和InnoDB引擎的区别

- MyISAM 不支持外键，而 InnoDB 支持
- MyISAM 是非事务安全型的，而 InnoDB 是事务安全型的。
- MyISAM 锁的粒度是表级，而 InnoDB 支持行级锁定。
- MyISAM 支持全文类型索引，而 InnoDB 不支持全文索引。
- MyISAM 相对简单，所以在效率上要优于 InnoDB，小型应用可以考虑使用 MyISAM。
- MyISAM 表是保存成文件的形式，在跨平台的数据转移中使用 MyISAM 存储会省去不少的麻烦。
- InnoDB 表比 MyISAM 表更安全，可以在保证数据不会丢失的情况下，切换非事务表到事务表（alter table tablename type=innodb）。

**应用场景：**

- MyISAM 管理非事务表。它提供高速存储和检索，以及全文搜索能力。如果应用中需要执行大量的 SELECT 查询，那么 MyISAM 是更好的选择。
- InnoDB 用于事务处理应用程序，具有众多特性，包括 ACID 事务支持。如果应用中需要执行大量的 INSERT 或 UPDATE 操作，则应该使用 InnoDB，这样可以提高多用户并发操作的性能。

## 锁机制

### 读写锁

在数据库中数据可以同时读取，但是不能同时写入，通过共享锁（读锁）和排他锁（写锁）来实现

读锁是共享的，可以同时读取一个资源

写锁是排他的，写的时候会阻塞其他读锁和写锁

### 锁粒度

锁定的时候如果只锁定修改的数据，进行精确的锁定，就会获得更高的系统并发度

需要锁的数据越少，系统并发度也就越高

#### 表锁

MySQL中最基本的锁策略，开销最小

进行写操作时，会锁住整张表，会锁住其他对该表的读写操作

#### 行级锁

行级锁可以最大程度的支持并发处理，在存储引擎层级别实现，比如InnoDB

#### MVCC（多版本并发控制）

行级锁的一个变种，避免锁操作，实现非阻塞读操作，写操作锁定必要的行

通过保存数据在某个时间点的快照实现

在InnoDB中，每行记录保存2个隐藏的列，创建时间和保存行的过期时间（事务版本号）

事务开始时候系统版本号为事务版本号

- 查询：查询版本早于当前事务版本号的数据行，同时删除版本未定义或大于当前当前的事务版本号，此时读取的数据行就是事务开始时就存在的，且没有删除的
- 插入：新插入的行把当前的系统版本号作为行版本号
- 删除：把当前的系统版本号作为行删除标识
- 更新：插入一条新纪录，然后删除之前的记录，并记录对应的版本号